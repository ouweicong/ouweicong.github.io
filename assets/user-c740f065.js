import{bp as e,aO as t}from"./index-28412557.js";import{_ as r}from"./user-9b1b9132.js";let n;async function s(e){if(n)return n;const{VITE_WS_ADDRESS:t}={VITE_BASE_URL:"/",VITE_APP_NAME:"校园管理系统",VITE_APP_TITLE:"校园管理系统",VITE_APP_DESC:"校园管理系统是一个非常惊奇的系统",VITE_AUTH_ROUTE_MODE:"static",VITE_ROUTE_HOME_PATH:"/dashboard/analysis",VITE_ICON_PREFFIX:"icon",VITE_ICON_LOCAL_PREFFIX:"icon-local",VITE_PROXY_DOMAIN_REAL:"http://8.138.111.247:9090",VITE_WS_ADDRESS:"ws://8.138.111.247:9090",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};n=new WebSocket(`${t}/wsServer/${e}`);function r(e){}function i(e){}function a(t){s(e)}return n.addEventListener("open",r,!1),n.addEventListener("close",i,!1),n.addEventListener("error",a,!1),n.addEventListener("message",o,!1),n}function o(e){const t=JSON.parse(e.data);ConcreteSubject.getConcreteSubjectInstance().notifyObservers(t.type,t.data,t.sendTime)}class ConcreteSubject{static instance=null;constructor(){}static getConcreteSubjectInstance(){return null===this.instance&&(this.instance=new ConcreteSubject),this.instance}observerList=[];addObserver(e){if(!["chat","notification","requestFriend"].includes(e.type))throw new Error("增加订阅者错误，类型错误");if(!e.id)throw new Error("缺少订阅者id");this.observerList.push(e)}removeObserver(e){const t=this.observerList.findIndex((t=>{t.id,e.id}));this.observerList.splice(t,1)}notifyObservers(e,t,r=null){this.observerList.forEach((n=>{n.type===e&&n.update(t,r)}))}}class InvalidTokenError extends Error{}function i(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(r){return atob(t)}}InvalidTokenError.prototype.name="InvalidTokenError";const a=e("user",{state:()=>({user:function(){try{const e=function(e,t){if("string"!=typeof e)throw new InvalidTokenError("Invalid token specified: must be a string");t||(t={});const r=!0===t.header?0:1,n=e.split(".")[r];if("string"!=typeof n)throw new InvalidTokenError(`Invalid token specified: missing part #${r+1}`);let s;try{s=i(n)}catch(o){throw new InvalidTokenError(`Invalid token specified: invalid base64 for part #${r+1} (${o.message})`)}try{return JSON.parse(s)}catch(o){throw new InvalidTokenError(`Invalid token specified: invalid json for part #${r+1} (${o.message})`)}}(String(t.get("access_token")??""),{header:"owc真帅"});return e?.userId&&(r(e?.userId).then((e=>{a().setUser(e.data)})),s(e.userId)),e}catch(e){return{}}}()}),getters:{},actions:{setUser(e){Object.assign(this.user,{...e}),s(e.userId)}}});a();export{ConcreteSubject as C,a as u};
